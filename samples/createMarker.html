<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="cache-control" content="no-cache">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
		integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="assets/js/galigeo-api.js"></script>

<title>Marker Sample</title>
</head>

<body>

	<div class="row">
		<div class="col s12 m3 l3" id="actionPanel">
			<div class='row'>Click on the map to Add Marker</div>
			<div class='row'>
				<div class='col s6 m4 l3'>
					<input type='button' value='Delete' onClick='deleteMarker()' />
				</div>
			</div>
		</div>
		<div class="col s12 m9 l9">
			<div id="mapId"
				style="position: absolute; height: 100%; width: 600px"></div>
		</div>
	</div>
	<script type="text/javascript">
		var ggoMap;
		var markerLayerId;
		var color = "blue";
		function addMarker(event) {
			if (event) {
				deleteMarker();
				var coordinates = [ event.lat, event.lng ];
				var iconSvgOptions = {
					iconSize : [ 40, 40 ]
				};
				var svgXml = `<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="map-marker" class="svg-inline--fa fa-map-marker fa-w-12" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="${color}" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0z"></path></svg>`;
				var url = encodeURI("data:image/svg+xml," + svgXml).replace(
						'#', '%23');
				ggoMap.addMarker(coordinates, undefined,
						iconSvgOptions, url).then(res => {
							markerLayerId = res.layer_id;
						});
			} else {
				alert("click in the map");
			}
		}
		
		function deleteMarker() {
			if (markerLayerId) {
				ggoMap.removeLayerById(markerLayerId).then(res => {
					console.log(res)
				  });
			}
		}

		$(document).ready(
				function() {
					var location = 'http://localhost:8080/Galigeo';
					var msg;
					ggoMap = new Galigeo.Map('mapId', {
						id : 'createMarker',
						name : 'Marker',
						apiKey : 'api_demo',
						url : location
					});
					ggoMap.load().then(() => {
						ggoMap.addEventListener('click', (evt) => {
						  console.log(evt);
						  addMarker(evt);
						})
					});
				});
	</script>

</body>

</html>